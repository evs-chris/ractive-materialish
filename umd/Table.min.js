!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("ractive")):"function"==typeof define&&define.amd?define(["ractive"],e):t.RMTable=e(t.Ractive)}(this,function(t){"use strict";function e(t,e){if(!e.length||"object"==typeof t){for(var n=t,r=0;r<e.length;r++)if("object"!=typeof(n=n[e[r]]))return r+1<e.length?void 0:n;return n}}function n(t,e){return t<e?-1:t>e?1:t==e?0:!t&&e?-1:t&&!e?1:0}t=t&&t.hasOwnProperty("default")?t.default:t;var r="undefined"!=typeof window?window:null,i=/^([-+])?([^\s]+)$/,s=function(t){function e(e){t.call(this,e)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.allSelected=function(){for(var t=this.get("selections"),e=this.get("visibleRows"),n=0;n<e.length;n++)if(!~t.indexOf(e[n]))return!1;return!0},e.prototype.nodeSet=function(t,e,n){t[e]=n},e.prototype._setSort=function(t,e){var n=this.get("columns."+t);if(n&&(n.sort||n.filter)){var r=n.sort||n.filter;"string"==typeof r&&"~"===r[0]&&(r=this.get(r));var s=e.ctrlKey,o=this.get("sort");if(Array.isArray(r)||(r=[r]),o?Array.isArray(o)||(o=[o]):o=[],o.length){var a=o.map(function(t){return i.exec(t).slice(1)}),l=r.reduce(function(t,e){return t&&!!a.find(function(t){return t[1]===e})},!0);l&&o.length!==r.length&&!s?this.set("sort",r.map(function(t){return"+"+r})):s?l?this.set("sort",a.map(function(t){return~r.indexOf(t[1])?("+"===t[0]?"-":"+")+t[1]:t[0]+t[1]})):this.set("sort",o.concat(r.map(function(t){return"+"+t}))):l?this.set("sort",a.map(function(t){return("+"===t[0]?"-":"+")+t[1]})):this.set("sort",r.map(function(t){return"+"+t}))}else this.set("sort",r.map(function(t){return"+"+t}))}},e.prototype._select=function(t,e){var n=this.get("selections");n||(n=[],this.set("selections",n));var r=n.indexOf(t);~r?this.splice("selections",r,1):this.push("selections",t),(r>=n.length||1===n.length)&&this.set("selected",n[n.length-1]),this.fire("selection",{},{item:n[n.length-1],items:n}),setTimeout(function(){return e.target.checked=!~r})},e.prototype.select=function(){var t=this.get("selected");t&&this.fire("selected",{},t,this.get("rows").indexOf(t),this.get("visibleRows").indexOf(t))},e.prototype.selectionOffset=function(t){var e=this.get("selected"),n=this.get("visibleRows");if(e&&~n.indexOf(e)){var r=n.indexOf(e);if(t>0?r+t>=n.length:r+t<0){var i=t<1?-1:1;(i<0&&this.get("page")+i>=0||i>0&&this.get("page")+i<this.get("pagination.total"))&&this.add("page",i),n=this.get("visibleRows");var s=t>0?n[0]:n[n.length-1];this.set({selected:s,selections:[s]})}else this.set({selected:n[r+t],selections:[n[r+t]]})}else{var o=t>0?n[0]:n[n.length-1];this.set({selected:o,selections:[o]})}this.fire("selection",{},{item:this.get("selected"),items:this.get("selections")})},e.prototype.selectionDown=function(){this.selectionOffset(1)},e.prototype.selectionUp=function(){this.selectionOffset(-1)},e}(t);t.extendWith(s,{template:{v:4,t:[{t:7,e:"div",m:[{n:"class-rtable",t:13},{n:"class-rtable-virtual",t:13,f:[{t:2,x:{r:["~/paginate"],s:'_0==="virtual"'}}]},{n:"class-rtable-auto",t:13,f:[{t:2,x:{r:["~/paginate"],s:'_0==="auto"'}}]}],f:[{t:7,e:"div",m:[{n:"class-rtable-top",t:13}],f:[{t:7,e:"table",m:[{t:16,r:"extra-attributes"}],f:[{t:8,r:"head"}," ",{t:8,r:"body"}," ",{t:4,f:[{t:7,e:"tr",m:[{n:"class-rtable-row",t:13}],f:[{t:7,e:"td",m:[{n:"colspan",f:[{t:2,x:{r:["~/columns.length","~/allowSelect"],s:"_0+(_1?1:0)"}}],t:13}],f:[{t:16,r:"empty"}]}]}],n:50,x:{r:["~/rows.length"],s:"!_0"}}]}]}," ",{t:8,r:"pagination"}]}],e:{'_0==="virtual"':function(t){return"virtual"===t},'_0==="auto"':function(t){return"auto"===t},"_0+(_1?1:0)":function(t,e){return t+(e?1:0)},"!_0":function(t){return!t},"[_0._setSort(_1,_2)]":function(t,e,n){return[t._setSort(e,n)]},"[_0._select(_1,_2),false]":function(t,e,n){return[t._select(e,n),!1]},'[["select",_2,_0.indexOf(_2),_1.indexOf(_2)]]':function(t,e,n){return[["select",n,t.indexOf(n),e.indexOf(n)]]},"~_0.indexOf(_1)":function(t,e){return~t.indexOf(e)},"_0*_1+1":function(t,e){return t*e+1},"_2+1===_0?_1:(_2+1)*_3":function(t,e,n,r){return n+1===t?e:(n+1)*r},"_0&&_1":function(t,e){return t&&e},"_0===1":function(t){return 1===t},'[_0.set("page",_1-1)]':function(t,e){return[t.set("page",e-1)]},"_0>0":function(t){return t>0},'[(/^\\d+$/.test(_1)&&+_1>0&&+_1<=_0&&_2.set("page",+_1-1))||_2.nodeSet(_3,"value",_4+1)]':function(t,e,n,r,i){return[/^\d+$/.test(e)&&+e>0&&+e<=t&&n.set("page",+e-1)||n.nodeSet(r,"value",i+1)]},"_0==_1+1":function(t,e){return t==e+1},'[_0.set("page",_2[_1-1])]':function(t,e,n){return[t.set("page",n[e-1])]},'_0==="..."':function(t){return"..."===t},'[_0.set("page",_1+1)]':function(t,e){return[t.set("page",e+1)]},"_0<_1-1":function(t,e){return t<e-1}},p:{"csp-dummy":[{t:7,e:"div",m:[{n:["click"],t:70,f:{r:["@this",".index","@event"],s:"[_0._setSort(_1,_2)]"}},{n:["click"],t:70,f:{r:["@this",".","@event"],s:"[_0._select(_1,_2),false]"}},{n:["click"],t:70,f:{r:["~/rows","~/visibleRows","."],s:'[["select",_2,_0.indexOf(_2),_1.indexOf(_2)]]'}}]}," ",{t:4,f:["..."],n:50,x:{r:["~/selections","."],s:"~_0.indexOf(_1)"}}],empty:["No data."],pagination:[{t:7,e:"div",m:[{n:"class-rtable-bottom",t:13}],f:[{t:7,e:"div",m:[{n:"class-rtable-info",t:13}],f:[{t:4,f:[{t:2,x:{r:["~/page","~/pagination.per"],s:"_0*_1+1"}}," - ",{t:2,x:{r:["~/pagination.total","~/rows.length","~/page","~/pagination.per"],s:"_2+1===_0?_1:(_2+1)*_3"}}," of ",{t:2,r:"~/rows.length"},{t:4,f:[" (",{t:2,r:"~/items.length"}," total)"],n:50,r:"~/isFiltered"}],n:50,x:{r:["pagination","rows.length"],s:"_0&&_1"}}," ",{t:4,f:["Â "],n:50,x:{r:["_paginate"],s:"_0===1"}}]}," ",{t:7,e:"div",m:[{n:"class-rtable-pages",t:13}],f:[{t:4,f:[{t:7,e:"span",m:[{n:["click"],t:70,f:{r:["@this","~/page"],s:'[_0.set("page",_1-1)]'}}],f:["Previous"]}],n:50,x:{r:["~/page"],s:"_0>0"}}," ",{t:4,f:[{t:4,f:[{t:7,e:"input",m:[{n:["change"],t:70,f:{r:["~/pagination.total","@node.value","@this","@node","~/page"],s:'[(/^\\d+$/.test(_1)&&+_1>0&&+_1<=_0&&_2.set("page",+_1-1))||_2.nodeSet(_3,"value",_4+1)]'}},{n:"value",f:[{t:2,r:"."}],t:13},{t:73,v:"t",f:"false"}]}],n:50,x:{r:[".","~/page"],s:"_0==_1+1"}},{t:4,n:50,f:[{t:7,e:"span",m:[{n:["click"],t:70,f:{r:["@this","@index","../"],s:'[_0.set("page",_2[_1-1])]'}}],f:["..."]}],x:{r:["."],s:'_0==="..."'},l:1},{t:4,n:51,f:[" ",{t:7,e:"span",m:[{n:["click"],t:70,f:{r:["@this","."],s:'[_0.set("page",_1-1)]'}}],f:[{t:2,r:"."}]}],l:1}],n:52,r:"~/pagination.array"}," ",{t:4,f:[{t:7,e:"span",m:[{n:["click"],t:70,f:{r:["@this","~/page"],s:'[_0.set("page",_1+1)]'}}],f:["Next"]}],n:50,x:{r:["~/page","~/pagination.total"],s:"_0<_1-1"}}]}]}],body:[{t:4,f:[{t:8,r:"row"}],n:52,r:"~/visibleRows"}]}},css:function(t){return[function(t){return"\n   .rtable {\n     display: flex;\n     flex-direction: column;\n     overflow: auto;\n     max-width: 100%;\n     max-height: 100%;\n     box-sizing: border-box;\n     flex-grow: 2;\n   }\n \n   .rtable > div > table {\n     width: 100%;\n     border-collapse: collapse;\n   }\n \n   .rtable td {\n     padding: 0.5em;\n   }\n \n   .rtable-header {\n     padding: 0.5em;\n     text-align: left;\n   }\n \n   .rtable-number-column {\n     text-align: right;\n   }\n   .rtable-date-column {\n     text-align: right;\n   }\n \n   .rtable-header {\n     border-bottom: 1px solid "+(t("table.divider")||t("table.fg")||t("fg1")||"#999")+";\n   }\n \n   .rtable-header > th {\n     padding: 0.3em 0.5em 1em 0.5em;\n   }\n \n   .rtable-row {\n     color: "+(t("table.fg")||t("fg1")||"#000")+";\n     border-bottom: 1px solid "+(t("table.divider")||t("table.fg")||t("fg1")||"#999")+";\n     background-color: "+(t("table.odd")||t("bg1")||"#fff")+";\n     transition: 0.2s ease-in-out;\n     transition-property: background-color, color;\n   }\n   .rtable-row:nth-child(even) {\n     background-color: "+(t("table.even")||t("bga1")||"#eee")+";\n   }\n   .rtable-row:last-of-type {\n     border-bottom: none;\n   }\n   .rtable-row:hover {\n     background-color: "+(t("table.over")||"#eee")+";\n   }\n \n   .rtable-row.rtable-selected {\n     background-color: "+(t("table.selected.bg")||t("bg2")||"#fe7")+";\n     color: "+(t("table.selected.fg")||t("fg2")||"#fff")+";\n   }\n \n   .rtable-top {\n     flex-grow: 5;\n     flex-shrink: 1;\n     overflow-y: auto;\n     margin: 0.5em 0;\n   }\n \n   .rtable-bottom {\n     display: flex;\n     flex-wrap: wrap;\n     flex-shrink: 0;\n   }\n \n   .rtable-info {\n     min-width: 50%;\n   }\n   .rtable-pages {\n     min-width: 50%;\n     text-align: right;\n   }\n   .rtable-pages span {\n     margin: 0.3em;\n     cursor: pointer;\n     user-select: none;\n   }\n   .rtable-pages span:first-of-type {\n     margin-left: 0;\n   }\n   .rtable-pages input {\n     text-align: center;\n     width: 2.5em;\n     font-size: 1em;\n     background-color: transparent;\n     border: none;\n     padding: 0;\n     font-weight: bold;\n     text-decoration: underline;\n   }\n \n   .rtable-select {\n     width: 0;\n     outline: none;\n     margin-right: 1em;\n   }\n   .rtable-select:before {\n     content: '';\n     display: block;\n     border: 2px solid "+(t("fg1")||"#222")+";\n     width: 1em;\n     height: 1em;\n     box-sizing: border-box;\n     transition: 0.2s ease-in-out;\n     transition-property: transform, border-color, height, width;\n   }\n   .rtable-select:checked:before {\n     height: 0.7em;\n     width: 1.3em;\n     border-color: "+(t("fg2")||"#f9f9f9")+";\n     border-top-color: transparent;\n     border-right-color: transparent;\n     transform: rotate(-50deg);\n   }\n   .rtable-select-header {\n     text-align: center;\n   }\n   .rtable-select-header,\n   .rtable-select-row {\n     width: 3em;\n   }\n   .rtable-select-header .rtable-select:checked:before {\n     border-color: "+(t("fg1")||"#222")+";\n     border-top-color: transparent;\n     border-right-color: transparent;\n   }\n   "}.call(this,t)].join(" ")},cssId:"rtable",attributes:["paginate","items","filter","sort"],on:{construct:function(){function t(t,e){if(t&&t.f&&1===t.f.length&&2===t.f[0].t){var n="_a"+a++;return r.push({t:13,n:n,f:t.f}),e?{t:[{t:2,r:"~/"+n}]}:{t:2,r:"~/"+n}}return t&&t.f}var e=this.component;if(e){var n=e.template.f||[],r=e.template.m?e.template.m.slice():[],i=e.template;e.template={e:i.e,f:i.f,t:i.t,m:r};var s=[],a=0;n.forEach(function(e){if("column"===e.e){var n={};n.index=s.length,s.push(n),n.content=(e.f||[]).filter(function(t){return"edit"!==t.e}),n.label=e.m.find(function(t){return"label"===t.n}),n.label&&n.label.f&&(n.label=t(n.label)),n.label||(n.label=""),Array.isArray(n.label)||(n.label=[n.label]),n.type=e.m.find(function(t){return"type"===t.n}),n.type&&n.type.f&&(n.type=n.type.f),n.type||(n.type="string"),n.filter=e.m.find(function(t){return"filter"===t.n}),n.filter&&n.filter.f&&(n.filter=t(n.filter),n.filter.r&&(n.filter=n.filter.r)),n.sort=e.m.find(function(t){return"sort"===t.n}),n.sort&&n.sort.f&&(n.sort=t(n.sort),n.sort.r&&(n.sort=n.sort.r)),n.hidden=e.m.find(function(t){return"hidden"===t.n}),n.hidden&&0===n.hidden.f?n.hidden=!0:n.hidden&&"object"==typeof n.hidden.f?n.hidden=t(n.hidden):n.hidden=!1,"string"==typeof n.hidden&&(n.hidden=!1),n.attrs=e.m.filter(function(t){return!~o.indexOf(t.n)})}}),this._items={columns:s};var l=[{t:7,e:"tr",m:[{t:13,n:"class-rtable-header"}],f:s.filter(function(t){return!0!==t.hidden}).map(function(t){var e={t:7,e:"th",f:t.label,m:[{t:13,n:"class-rtable-header"},{t:4,n:53,r:"~/columns."+t.index,f:[{t:70,n:["click"],f:{r:["@this",".index","@event"],s:"[_0._setSort(_1,_2)]"}}]}]};t.type&&e.m.push({t:13,n:"class-rtable-"+t.type+"-column"});var n=e;return t.hidden&&t.hidden.r&&(n={t:4,n:51,r:t.hidden.r,f:[e]}),n})}];l[0].f.unshift({t:4,n:50,r:"~/allowSelect",f:[{t:7,e:"th",m:[{t:13,n:"class-rtable-select-header"}],f:[{t:4,n:50,r:"~/allowSelectAll",f:[{t:7,e:"input",m:[{t:73,v:"t",f:"false"},{t:13,n:"type",f:"checkbox"},{t:13,n:"checked",f:[{t:2,x:{r:["@this"],s:"_0.allSelected()"}}]},{t:70,n:["click"],f:"selectAll"},{t:13,n:"class-rtable-select"}]}]}]}]});var f=[{t:7,e:"tr",f:s.filter(function(t){return!0!==t.hidden}).map(function(t){var e={t:7,e:"td",f:t.content,m:t.attrs};t.type&&(e.m=[{t:13,n:"class-rtable-"+t.type+"-column"}]);var n=e;return t.hidden&&t.hidden.r&&(n={t:4,n:51,r:t.hidden.r,f:[e]}),n}),m:[{t:13,n:"class-rtable-row"},{t:13,n:"class-rtable-selected",f:[{t:2,x:{r:["~/selections","."],s:"~_0.indexOf(_1)"}}]},{t:70,n:["click"],f:{r:["~/rows","~/visibleRows","."],s:"[['selected',_2,_0.indexOf(_2),_1.indexOf(_2)]]"}}]}];f[0].f.unshift({t:4,n:50,r:"~/allowSelect",f:[{t:7,e:"th",m:[{t:13,n:"class-rtable-select-row"}],f:[{t:7,e:"input",m:[{t:73,v:"t",f:"false"},{t:13,n:"type",f:"checkbox"},{t:13,n:"checked",f:[{t:2,x:{r:["~/selections","."],s:"~_0.indexOf(_1)"}}]},{t:70,n:["click"],f:{r:["@this",".","@event"],s:"[_0._select(_1,_2),false]"}},{t:13,n:"class-rtable-select"}]}]}]}),this._row=f,this._head=l}},config:function(){this._items&&this.set(this._items),this._row&&(this.partials.row=this._row),this._head&&(this.partials.head=this._head)},render:function(){this._autoObserver&&this._autoObserver.fire()},selectAll:function(){var t,e;this.allSelected()?(e=null,t=[],this.set({selections:t,selected:e})):(e=(t=this.get("visibleRows").slice())[0],this.set({selections:t,selected:e})),this.fire("selection",{},{item:e,items:t})}},observe:{paginate:function(e){var n=this;if("auto"===e||e instanceof t){this._autoObserver&&this._autoObserver.cancel();var r="auto"===e?this.root:e,i=function(){if(n.fragment.rendered){var t=n.find(".rtable-top");if(t&&i.last!==t.clientHeight){n.set("_paginate",1);var e=n.findAll("tr");n.set("_paginate",Math.floor((t.clientHeight-e[0].offsetHeight)/e[1].offsetHeight)),i.last=t.clientHeight}}};this._autoObserver=r.on("*.resize",i),this._autoObserver.fire=i}else this._autoObserver&&this._autoObserver.cancel()}},data:function(){return{page:0,selections:[],allowSelect:!0,allowSelectAll:!0}},computed:{rows:{get:function(){var r=this,i=this.viewmodel.value.columns.filter(function(t){return t.filter}).map(function(e){var n=e.filter;if(0===n.indexOf("~/")&&(n=r.get(n)),"string"==typeof n&&(n=t.splitKeypath(n)),Array.isArray(n))return n}).filter(function(t){return t}),s=this.get("items"),o=s,a=this.get("filter"),l=this.get("sort");if("string"==typeof a){var f=a===a.toLowerCase()||a===a.toUpperCase(),c=new RegExp(a,f?"i":"");s=s.filter(function(t){for(var n=i.length;n--;){var r=e(t,i[n]);if(c.test(r))return!0}return!1})}else a instanceof RegExp&&(s=s.filter(function(t){for(var n=i.length;n--;){var r=e(t,i[n]);if(t&&"string"==typeof r&&a.test(r))return!0}}));return"string"==typeof l&&(l=[l]),Array.isArray(l)&&(l=l.map(function(e){return{dir:"-"===e[0]?-1:1,path:t.splitKeypath("-"===e[0]||"+"===e[0]?e.substr(1):e)}}),s.sort(function(t,r){for(var i,s,o,a=0;a<l.length;a++)if(i=e(t,l[a].path),s=e(r,l[a].path),0!==(o=l[a].dir*n(i,s)))return o;return o})),this.set("isFiltered",o.length!==s.length),s}},visibleRows:{get:function(){var e=this,n=this.get("rows"),r=this.get("paginate"),i=this.get("_paginate"),s=this.get("page")||0;return r?("number"!=typeof r&&isNaN(+r)&&(r="auto"===r||r instanceof t?i||1:30),s*r>n.length&&setTimeout(function(){return e.set("page",0)},0),n.slice(r*s,r*s+r)):n}},pagination:{get:function(){var t=this.get("items"),e=this.get("rows"),n=this.get("paginate"),r=this.get("page")||0;if("number"!=typeof n&&isNaN(n)&&(n=this.get("_paginate")),n){var i=Math.ceil(e.length/n),s={max:Math.ceil(t.length/n),total:i,per:n};if(s.total>14){var o=s.array=[];r>5?o.push(1,2,3,"..."):o.push(1,2,3,4,5,6,7,8),r>5&&r+6<i?o.push(r-1,r,r+1,r+2,r+3,"...",i-2,i-1,i):r+6<i?o.push("...",i-2,i-1,i):o.push(i-7,i-6,i-5,i-4,i-3,i-2,i-1,i)}else s.array=Array.apply(null,{length:s.total}).map(function(t,e){return e+1});return s}}}}});var o=["label","type","filter","hidden","sort"];return function(t,e,n){if(r&&r.Ractive&&"object"==typeof r.Ractive[e]){var i=document.currentScript;if(i||(i=(i=document.querySelectorAll("script"))[i.length-1]),i){var s=i.getAttribute("data-alias");s&&(s=(s=s.split("&")).reduce(function(t,e){var n=e.split("="),r=n[0],i=n[1];return t[r]=i,t},{})),Ractive[e][s&&s[t]||t]=n}}}("RMTable","components",s),s});
