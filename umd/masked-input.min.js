!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.RM_masked_input=t()}(this,function(){"use strict";function e(t,i,s,a){function o(e,n){if(e||!(Math.abs(t.selectionEnd-t.selectionStart)>1)){for(var i=t.selectionStart,s=t.value,a=l.mask,o=a.length,f="",r="",u="",c=0,m=0,p=0,v=0;p<o;p++){var y=l.masks[a[p]],b=v<s.length&&y&&y.test(s[v]);if(b)r+=s[v],u+=s[v],f+=s[v++],c=p+1;else{if(y){for(;!b&&v++<s.length;)b=y.test(s[v]);b&&c===p&&m--}else c===p&&(c=p+1,m++,u+=a[p]);b?p--:f+=a[p]}}if(k.value=r,k.masked=u,k.display=f,t.value=f,e)i=c;else if(!n){(i>c+m||c+m<=a.length&&i+m===c)&&(i=c);for(var g=i;g<=o&&!l.masks[a[g]];g++)i++}n?t.setSelectionRange(i,i):e&&i===a.length?t.setSelectionRange(0,i+1):t.setSelectionRange(i,i+1),d&&!1===l.lazy&&d()}}var l,f=this.getContext(t);l="object"==typeof i?i:"object"==typeof s?s:"object"==typeof a?a:{},"string"==typeof i&&(l.mask=i),"string"==typeof s&&(l.bind=s),l.mask=l.mask||"",l.masks=l.masks||e.defaults.masks,l.maskChars="",l.bind_value=l.bindValue||l.bind,l.bind_masked=l.bindMasked,l.bind_display=l.bindDisplay;for(var r in l.masks)if(r.length>1)for(var u=0;u<r.length;u++)l.masks[r[u]]=l.masks[r];var c,d,k={},m={};n.forEach(function(e){l["bind_"+e]&&(c||(c={}),c[e]=f.observe(l["bind_"+e],function(e){t.value=e,o(!1,!1)},{init:!1}),m[e]=f.get(l["bind_"+e]))}),c&&(d=function(e){n.forEach(function(e){c[e]&&k[e]!==m[e]&&(c[e].silence(),f.set(l["bind_"+e],k[e]),m[e]=k[e],c[e].resume())})},f.listen("blur",d));var p=function(e){o("focus"===e.type,e.key&&(~e.key.indexOf("Arrow")||~e.key.indexOf("Backspace")||~e.key.indexOf("Del")))};return f.listen("keyup",p),f.listen("focus",p),t.value=m.value||m.masked||m.display||l.mask,c&&o(!1,!1),{teardown:function(){f.unlisten("keyup",p),f.unlisten("focus",p),c&&(f.unlisten("blur",d),n.forEach(function(e){return c[e]&&c[e].cancel()}))}}}var t="undefined"!=typeof window?window:null,n=["value","masked","display"];return e.defaults={masks:{"#":/\d/,"?":/\w/,"@":/[a-zA-Z]/}},function(e,n,i){if(t&&t.Ractive&&"object"==typeof t.Ractive[n]){var s=document.currentScript;if(s||(s=(s=document.querySelectorAll("script"))[s.length-1]),s){var a=s.getAttribute("data-alias");a&&(a=(a=a.split("&")).reduce(function(e,t){var n=t.split("="),i=n[0],s=n[1];return e[i]=s,e},{})),Ractive[n][a&&a[e]||e]=i}}}("masked","decorators",e),e});
