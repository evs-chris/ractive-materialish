!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.RM_scroll_spy={})}(this,function(t){"use strict";function e(t,e,o){if(u&&u.Ractive&&"object"==typeof u.Ractive[e]){var n=document.currentScript;if(n||(n=(n=document.querySelectorAll("script"))[n.length-1]),n){var r=n.getAttribute("data-alias");r&&(r=(r=r.split("&")).reduce(function(t,e){var o=e.split("="),n=o[0],r=o[1];return t[n]=r,t},{})),Ractive[e][r&&r[t]||t]=o}}}function o(t,e,o,n){var i=d.find(function(e){return e.el===t});if(i||(i={el:t,ids:{}},d.push(i)),!i.inited){i.inited=!0;var s=!1;i.listener=function(e){e.target!==t||s||(window.requestAnimationFrame||setTimeout)(function(){r(i),s=!1},16.667)},setTimeout(function(){i.ready=!0,t.addEventListener("scroll",i.listener),r(i)},5)}return i.ids[e]||(i.ids[e]=[]),i.ids[e].push({node:o,opts:n}),i}function n(t,e,o){var n=d.find(function(e){return e.el===t});if(n){var r=n.ids[r];r&&r.splice(r.indexOf(o),1);for(var i in n.ids)if(n.ids[i].length)return;n.inited=!1,n.el.removeEventListener("scroll",n.listener)}}function r(t){var e=t.el===document?document.body:t.el,o=i(e),n=e.scrollHeight;if(t.ready){for(var f in t.ids){var c=t.ids[f][0],u=c.current,d=u,l=void 0===c.opts.range?0:c.opts.range,p=o;c.opts.offset&&(c.opts.offset<=1&&c.opts.offset>=0?p+=e.clientHeight*c.opts.offset:c.opts.offset>1&&(p+=c.opts.offset));var v=e.scrollHeight;if(u){var y=s(u.node,e);(!l||l>0&&y>p||l<0&&y<p)&&(v=Math.abs(y-p))}for(var m=a[f]||[],h=0;h<m.length;h++){var x=s(m[h].node,e);if(!l||!(l>0&&x<p||l<0&&x>p)){var g=Math.abs(x-p);g<=v&&(u=m[h],v=g)}}u!==d&&(c.opts.path&&c.ctx.set(c.opts.path,u.opts.value),d&&(d.hitout||(d.hitout=!0,d.ctx.element.attributes.find(function(t){return t.events&&~t.template.n.indexOf("firstscrollspyout")})&&d.ctx.raise("firstscrollspyout")),d.ctx.element.attributes.find(function(t){return t.events&&~t.template.n.indexOf("scrollspyout")})&&d.ctx.raise("scrollspyout")),u.hit||(u.hit=!0,u.ctx.element.attributes.find(function(t){return t.events&&~t.template.n.indexOf("firstscrollspy")})&&u.ctx.raise("firstscrollspy")),u.ctx.element.attributes.find(function(t){return t.events&&~t.template.n.indexOf("scrollspy")})&&u.ctx.raise("scrollspy"),c.current=u)}e.scrollHeight!==n&&r(t)}}function i(t){if(t===document.body){var e=window.getComputedStyle(t);if("auto"!==e.overflowY&&"scroll"!==e.overflowY)return window.scrollY}return t.scrollTop}function s(t,e){for(var o=t.offsetTop,n=t;n.offsetParent&&(n=n.offsetParent)!==e;)o+=n.offsetTop;return o}function f(t,e,r){var i,s=(i="string"==typeof e?{path:e}:e||{}).id||r||"",f=i.target||t;if(f!==document)if(f){var c=window.getComputedStyle(f),u=c["overflow-y"];"scroll"!==u&&"auto"!==u?f=document:c.position&&"static"!==c.position||(f.style.position="relative")}else f=document;var a=d.find(function(t){return t.ids[s]});if(a)return console.error("Can't to create duplicate scrollspy id '"+s+"'"),{update:function(){},teardown:function(){}};var l=(a=o(f,s,t,i)).ids[s].find(function(e){return e.node===t});return l&&(l.ctx=this.getContext(t)),{update:function(t,e){if(l){var o;(o="string"==typeof t?{path:t}:t||{}).id=o.id||e||"",l.opts=o}},teardown:function(){n(f,s,t)},id:s}}function c(t,e,o){var n,i=this,s=(n=void 0!==e&&"object"!=typeof e?{value:e}:e||{}).id||o||"";return setTimeout(function(){if(!s)for(var e=t.parentNode,o=i.getContext(e);e&&o;){if(o.decorators.scrollspy){s=o.decorators.scrollspy.id;break}e=e.parentNode,o=i.getContext(e)}var f=a[s]||(a[s]=[]),c={node:t,opts:n,ctx:i.getContext(t)};f.push(c),d.filter(function(t){return t.ids[s]}).forEach(r)},0),{update:function(t,e){var o;(o=void 0!==t&&"object"!=typeof t?{value:t}:{}).id=o.id||e||s||"",obj.opts=o},teardown:function(){ts.splice(ts.indexOf(obj),1),r(d.find(function(t){return t.ids[s]}))},id:s}}var u="undefined"!=typeof window?window:null,d=[],a={};e("scrollspy","decorators",f),e("spytarget","decorators",c),t.scrollspy=f,t.spytarget=c,Object.defineProperty(t,"__esModule",{value:!0})});
