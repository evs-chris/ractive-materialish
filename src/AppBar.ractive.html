<div class-rappbar {{yield extra-attributes}}>
  <div class-rappbar-left>{{#if ._leftP}}{{yield ._leftP}}{{/if}}</div>
  <div class-rappbar-center>{{#if ._centerP}}{{yield ._centerP}}{{/if}}</div>
  <div class-rappbar-right>{{#if ._rightP}}{{yield ._rightP}}{{/if}}</div>
  <div class-rappbar-wait class-waiting="waiting"></div>
</div>

<script>
  import Ractive from 'ractive';
  import globalRegister from './globalRegister';

  export class AppBar extends Ractive {
    constructor(opts) { super(opts); }

    get waiting() { return this.get('waiting'); }
    set waiting(show) { this.add('waiting', show ? 1 : -1); }
    wait(show) { this.waiting = show; }
  }

  Ractive.extendWith(AppBar, {
    template: $TEMPLATE,
    css: $CSS,
    cssId: 'appbar',
    attributes: ['waiting'],
    data() { return { waiting: 0 }; },
    on: {
      config() {
        const tpl = this.partials.content;
        if (tpl) {
          tpl.forEach(e => {
            if (e.e === 'left') this.set('_leftP', { t: e.f });
            if (e.e === 'center') this.set('_centerP', { t: e.f });
            if (e.e === 'right') this.set('_rightP', { t: e.f });
          });
        }
      }
    }
  });

  globalRegister('RMAppBar', 'components', AppBar);

  export function plugin(opts = {}) {
    return function({ instance }) {
      instance.components[opts.name || 'app-bar'] = AppBar;
    }
  }

  export default plugin;
</script>

<script rel="css">
  return `
  .rappbar {
    display: flex;
    padding: 1em;
    background-color: ${data('appbar.bg') || data('bg2') || '#07e'};
    color: ${data('appbar.fg') || data('fg2') || '#f9f9f9'};
    position: relative;
  }

  .rappbar-left {
    flex-grow: 3;
    display: flex;
    justify-content: flex-start;
  }

  .rappbar-right {
    flex-grow: 3;
    display: flex;
    justify-content: flex-end;
  }

  .rappbar-center {
    flex-shrink: 1;
  }

  .rappbar-wait {
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 0.5em;
    opacity: 0;
    transition: opacity 0.3s ease-in-out;
    background: linear-gradient(to left, ${data('appbar.wait.color1') || 'rgba(255, 255, 255, 0.7)'}, ${data('appbar.wait.color2') || 'rgba(0, 0, 0, 0.1)'}, ${data('appbar.wait.color1') || 'rgba(255, 255, 255, 0.7)'});
    background-size: 600% 600%;
    animation: rappbar-roll 10s linear infinite;
    animation-play-state: paused;
  }

  .rappbar-wait.waiting {
    opacity: 1;
    animation-play-state: running;
  }

  @keyframes rappbar-roll {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
  }
  `;
</script>
